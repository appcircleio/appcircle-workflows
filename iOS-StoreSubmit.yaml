---
directories:
- AC_SOURCE
- AC_OUTPUT_DIR
steps:
- componentType: appcircle_custom_script
  componentVersion: "1.0.*"
  stepName: Custom Script
  enabled: true
  onError: $exit
  webUrl: https://github.com/appcircleio/appcircle-custom-script-component
  repoUrl: https://github.com/appcircleio/appcircle-custom-script-component.git
  commit: cbea20fd9b7c43c6d1c98390ded12466f15287bf
  inputs:
  - Execute: "bash"
  - Script: |
      apt-get update 
      apt-get install ruby-full ruby-dev gcc libffi-dev make build-essential g++ -y
      apt-get install rubygems -y
      apt-get install ubuntu-dev-tools -y
      gem install fastlane -NV
      gem install bundler

      apt-get install -y locales
      export LC_ALL=en_US.UTF-8
      export LANG=en_US.UTF-8
      locale-gen en_US.UTF-8
     
      echo $IPAFileName
      echo $IPAFileUrl     
      curl -o ./$IPAFileName -k $IPAFileUrl
      bundle init
      echo "gem \"fastlane\"">>Gemfile
      mkdir fastlane
      touch fastlane/Appfile
      touch fastlane/Fastfile
      echo $FastFileConfig>>fastlane/Fastfile
      echo $AppStoreConnectApiKey>>fastlane/$AppStoreConnectApiKeyFileName
      if $StackType ==10 
      	bundle exec fastlane TestFlight
      if $StackType ==12 
      	bundle exec fastlane Release
